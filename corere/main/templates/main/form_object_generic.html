{% extends "main/layout.html" %}
{% block content %}
{% load concat %}
{% load crispy_forms_tags %}

{% comment %} See the failed attempt html for more form customization and stuff trying to use dropzone {% endcomment %}

<script type="text/javascript">
    function deletenote(noteid) {
        var headers = new Headers();
        headers.append('X-CSRFToken', '{{ csrf_token }}');
        fetch('deletenote/'+noteid, {
            method: 'POST',
            headers: headers, 
            credentials: 'include'
        }).then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            }
        })
    }
</script>

<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
        {% crispy form helper %}
    {% if not read_only %}
    <input type="submit" name="submit" value="Save">
    {% endif %}
    {% block extrabuttons %}
    {% endblock %}
    <input type=button value="Back" onClick="javascript:history.go(-1);">
</form>
{% comment %}TODO: Move the below stuff to sub-templates and only use them on certain objects{% endcomment %}

{% if not read_only %}
<a href='createnote'>Add note</a> {% comment %} This gets added to manuscript but I'm not sure it should be {% endcomment %}
{% endif %}
{% for note in notes %}
    <p>{{note.text}} by {{note.creator}} 
    {% if not read_only  %}
        {% if user.username == note.creator.username %}
            {% comment %} Delete probably shouldn't be a link? {% endcomment %}
            (<a href={{ 'editnote/'|concat:note.id}}>Edit</a>) (<a href="javascript:void(0)" onClick="deletenote({{note.id}});">Delete</a>)
        {% endif %}
    {% endif %}
    </p> 
{% endfor %}
{% comment %} {% include "main/file_list.html" %} {% endcomment %}

{% endblock content %}
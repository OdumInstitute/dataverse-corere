{% extends "main/layout.html" %}
{% block content %}
{% load concat %}
{% load crispy_forms_tags %}

{% comment %} Disabled ajax add/remove formset entry code. Library seemed to flakey, maybe we'll use it later. {% endcomment %}
{% comment %} 
{% load static %}
<script src="{% static 'main/jquery.formset.20201005.min.js' %}"></script>
<script type="text/javascript">
    $(function() {
        $('#generic_object_form tbody tr').formset();
    })
</script> {% endcomment %}

<h5 class="my-3"> {{page_header}}: {{root_object_title}} </h5>
<form id="generic_object_form" action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% crispy form helper %}
    {% if obj_type != 'manuscript' and not create %} {% comment %} and note_formset and note_helper | This may lead to view mistakes failing silently {% endcomment %}
        {% include "main/note_list.html" %}    
    {% endif %}
    {% comment %} {% if not read_only %} {% endcomment %}
    <input type="submit" name="submit" value="Save">
    {% comment %} {% endif %} {% endcomment %}
    {% block extrabuttons %}
    {% endblock %}
    <input type=button value="Back" onClick="javascript:history.go(-1);">
</form>
{% if obj_type != 'manuscript' %}
<script>
    {% comment %}
    Gets the last note tr, and from that sets the display of the creator dropdown to the user.get_username
    This was required to set the field to be the username. 
    Setting the selection on the backend conflicts with disabling the field, and hacking validation was a pain/unsafe.
    That being said, this is pretty brittle as well.
    {% endcomment %}
    var lastTr = document.getElementById('note_table').lastElementChild.lastElementChild;
    lastTr.firstElementChild.firstElementChild.firstElementChild.firstElementChild.textContent='{{ user.get_username }}'
</script>
{% endif %}

{% endblock content %}
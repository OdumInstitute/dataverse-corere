{% extends "main/layout.html" %}
{% load i18n %}
{% comment %} {% load verbose_names %} {% endcomment %}
{% load alias %}
{% block content %}
<table class="table table-bordered" id="table_manuscript_info">
    <tr>
        <td style="width: 30%">Manuscript Number</td>
        <td style="width: 70%">{{manuscript.pub_id}}</td>
    </tr>
    <tr>
        <td>Article Title</td>
        <td>{{manuscript.title}}</td>
    </tr>
    <tr>
        <td>Corresponding Author</td>
        <td>{{manuscript.contact_last_name}}{% if manuscript.contact_last_name %},{% endif %} {{manuscript.contact_first_name}}</td>
    </tr>
    <tr>
        <td>Dataverse DOI</td>
        <td>{{manuscript.dataverse_doi}}</td>
    </tr>
</table>

<table class="table table-bordered" id="table_submissions_info">
{% for submission in manuscript.manuscript_submissions.all %}
    <tr>
        <th colspan="2">Submission {{submission.version_id}}</th>
    </tr>
    <tr>
        <td style="width: 30%">Editor Submission Date</td>
        <td style="width: 70%">{{submission.submission_edition.created_at|date:"SHORT_DATE_FORMAT"}}</td>
    </tr>
    <tr>
        <td>Verification Date</td>
        <td>{% if submission.submission_verification %} {{submission.submission_verification.updated_at|date:"SHORT_DATE_FORMAT"}} {% elif submission.submission_curation %} {{submission.submission_curation.updated_at|date:"SHORT_DATE_FORMAT"}} {% elif submission.submission_edition %} {{submission.submission_edition.updated_at|date:"SHORT_DATE_FORMAT"}} {% endif %}</td>
    </tr>
    {% if submission.submission_curation %}{% comment %} this if is probably unneeded if we only show completed submissions that passed edition {% endcomment %}
    <tr>
        <td>Data Curation Result</td>
        <td>{{submission.submission_curation.get__status_display}}</td>
    </tr>
    <tr>
        <td>Data Curation Notes</td>
        {% with general_notes=submission.get_public_curator_notes_general category_notes=submission.get_public_curator_notes_category file_notes=submission.get_public_curator_notes_file%}     
        <td>
            General:
            <ul>
                <li>{{submission.submission_curation.report}}</li>
                {% for note in general_notes %}<li>{{note.text}}</li>{% endfor %}
            </ul>
            {% comment %} Category notes listed by category {% endcomment %}
            {% alias "" as previous_note_category %}
            {% for note in category_notes %}
                {% if note.ref_file_type != previous_note_category %}
                    {% if previous_note_category != '' %}
                        </ul>
                    {% endif %}
                    {{note.get_ref_file_type_display}}:<ul>
                    {% alias note.ref_file_type as previous_note_category %}
                {% endif %}
                <li>{{note.text}}</li>
            {% endfor %}</ul>

            {% comment %} File notes listed by file {% endcomment %}
            {% alias "" as previous_note_file %}
            {% for note in file_notes %}
                {% if note.ref_file.name != previous_note_file %}
                    {% if previous_note_file != '' %}
                        </ul>
                    {% endif %}
                    {{note.ref_file.name}}:<ul>
                    {% alias note.ref_file.name as previous_note_file %}
                {% endif %}
                <li>{{note.text}}</li>
            {% endfor %}</ul>
        </td>
        {% endwith %}
    </tr>
    {% endif %}
    {% if submission.submission_verification %}
    <tr>
        <td>Data Verification Result</td>
        <td>{{submission.submission_verification.get__status_display}}</td>
    </tr>
    <tr>
        <td>Data Verification Notes</td>
        {% with general_notes=submission.get_public_verifier_notes_general category_notes=submission.get_public_verifier_notes_category file_notes=submission.get_public_verifier_notes_file%}     
        <td>
            General:
            <ul>
                <li>{{submission.submission_verification.report}}</li>
                {% for note in general_notes %}<li>{{note.text}}</li>{% endfor %}
            </ul>
            Code Executability:
            <ul><li>{{submission.submission_verification.code_executability}}</li></ul>
            {% comment %} Category notes listed by category {% endcomment %}
            {% alias "" as previous_note_category %}
            {% for note in category_notes %}
                {% if note.ref_file_type != previous_note_category %}
                    {% if previous_note_category != '' %}
                        </ul>
                    {% endif %}
                    {{note.get_ref_file_type_display}}:<ul>
                    {% alias note.ref_file_type as previous_note_category %}
                {% endif %}
                <li>{{note.text}}</li>
            {% endfor %}</ul>

            {% comment %} File notes listed by file {% endcomment %}
            {% alias "" as previous_note_file %}
            {% for note in file_notes %}
                {% if note.ref_file.name != previous_note_file %}
                    {% if previous_note_file != '' %}
                        </ul>
                    {% endif %}
                    {{note.ref_file.name}}:<ul>
                    {% alias note.ref_file.name as previous_note_file %}
                {% endif %}
                <li>{{note.text}}</li>
            {% endfor %}</ul>
        </td>
        {% endwith %}
    </tr>
    {% endif %}
{% endfor %}
</table>

<table class="table table-bordered" id="table_citation_info">
{% comment %} we don't even store anything related to citation {% endcomment %}
</table>

{% endblock %}
{% comment %} {{submission.get__status_display}} {% endcomment %}

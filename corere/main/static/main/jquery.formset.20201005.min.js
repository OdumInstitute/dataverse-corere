!function(g){g.fn.formset=function(e){function l(e,a){c.extraClasses&&(e.removeClass(h),e.addClass(c.extraClasses[a%c.extraClasses.length]))}function o(e,a,s){var t=new RegExp(a+"-(\\d+|__prefix__)-"),d=a+"-"+s+"-";e.attr("for")&&e.attr("for",e.attr("for").replace(t,d)),e.attr("id")&&e.attr("id",e.attr("id").replace(t,d)),e.attr("name")&&e.attr("name",e.attr("name").replace(t,d))}function f(){return 0==u.length||""==u.val()||0<u.val()-p.val()}function m(){return 0==v.length||""==v.val()||0<p.val()-v.val()}function t(e){var n=g.trim(c.deleteCssClass).replace(/\s+/g,"."),i=g.trim(c.addCssClass).replace(/\s+/g,"."),a='<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>";c.deleteContainerClass?e.find('[class*="'+c.deleteContainerClass+'"]').append(a):e.is("TR")?e.children(":last").append(a):e.is("UL")||e.is("OL")?e.append("<li>"+a+"</li>"):e.append(a),m()||e.find("a."+n).hide(),e.find("a."+n).click(function(){var e=g(this).parents("."+c.formCssClass),a=e.find('input:hidden[id $= "-DELETE"]'),s=e.siblings("a."+i+", ."+c.formCssClass+"-add"),t=a.length?(a.val("on"),e.hide(),g("."+c.formCssClass).not(":hidden")):(e.remove(),g("."+c.formCssClass).not(".formset-custom-template"));p.val(t.length);for(var d=0,r=t.length;d<r;d++)l(t.eq(d),d),a.length||t.eq(d).find(x).each(function(){o(g(this),c.prefix,d)});return m()||g("a."+n).each(function(){g(this).hide()}),s.is(":hidden")&&f()&&s.show(),c.removed&&c.removed(e),!1})}var a,s,d,r,n,i,C,c=g.extend({},g.fn.formset.defaults,e),h=c.extraClasses.join(" "),p=g("#id_"+c.prefix+"-TOTAL_FORMS"),u=g("#id_"+c.prefix+"-MAX_NUM_FORMS"),v=g("#id_"+c.prefix+"-MIN_NUM_FORMS"),x="input,select,textarea,label,div",T=g(this);return T.each(function(e){var a=g(this),s=a.find('input:checkbox[id $= "-DELETE"]');s.length&&(s.is(":checked")?(s.before('<input type="hidden" name="'+s.attr("name")+'" id="'+s.attr("id")+'" value="on" />'),a.hide()):s.before('<input type="hidden" name="'+s.attr("name")+'" id="'+s.attr("id")+'" />'),g('label[for="'+s.attr("id")+'"]').hide(),s.remove()),0<a.find(x).length&&(a.addClass(c.formCssClass),a.is(":visible")&&(t(a),l(a,e)))}),T.length&&(a=!f(),c.formTemplate?((s=c.formTemplate instanceof g?c.formTemplate:g(c.formTemplate)).removeAttr("id").addClass(c.formCssClass+" formset-custom-template"),s.find(x).each(function(){o(g(this),c.prefix,"__prefix__")}),t(s)):(c.hideLastAddForm&&g("."+c.formCssClass+":last").hide(),(s=g("."+c.formCssClass+":last").clone(!0).removeAttr("id")).find('input:hidden[id $= "-DELETE"]').remove(),s.find(x).not(c.keepFieldValues).each(function(){var e=g(this);e.is("input:checkbox")||e.is("input:radio")?e.attr("checked",!1):e.val("")})),c.formTemplate=s,d='<a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a>",C=c.addContainerClass?((r=g('[class*="'+c.addContainerClass+'"')).append(d),r.find('[class="'+c.addCssClass+'"]')):T.is("TR")?(n=T.eq(0).children().length,i=g('<tr><td colspan="'+n+'">'+d+"</tr>").addClass(c.formCssClass+"-add"),T.parent().append(i),i.find("a")):(T.filter(":last").after(d),T.filter(":last").next()),a&&C.hide(),C.click(function(){var e=parseInt(p.val()),a=c.formTemplate.clone(!0).removeClass("formset-custom-template"),s=g(g(this).parents("tr."+c.formCssClass+"-add").get(0)||this),t=g.trim(c.deleteCssClass).replace(/\s+/g,".");return l(a,e),a.insertBefore(s).show(),a.find(x).each(function(){o(g(this),c.prefix,e)}),p.val(e+1),m()&&g("a."+t).each(function(){g(this).show()}),f()||s.hide(),c.added&&c.added(a),!1})),T},g.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addContainerClass:null,deleteContainerClass:null,addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null,hideLastAddForm:!1}}(jQuery);